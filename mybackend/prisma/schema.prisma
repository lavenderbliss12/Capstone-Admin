generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = "mysql://root:@localhost:3306/capstone"
}

model user {
  id           Int                 @id @default(autoincrement()) @map("user_id")
  uid          String              @unique(map: "uid") @db.VarChar(36)
  username     String              @db.VarChar(100)
  surname      String              @db.VarChar(50)
  name         String              @db.VarChar(50)
  email        String              @unique(map: "email") @db.VarChar(100)
  password     String              @db.VarChar(50)
  points       Int                 @default(0) @map("total_points")
  date_created DateTime            @default(now()) @map("date_registered") @db.DateTime(0)
  biowaste     biowaste_disposal[]
  checkpoint   checkpoint?
  transactions transaction[]

  @@map("user_info")
}

model transaction {
  reference_id     BigInt   @id @default(autoincrement()) @map("transaction_id")
  user_id          Int
  reward_name      String   @db.VarChar(100)
  points_used      Int
  transaction_date DateTime @default(now()) @db.DateTime(0)
  user             user     @relation(fields: [user_id], references: [id], onDelete: Cascade, map: "fk_tx_user")

  @@index([user_id], map: "idx_tx_user_id")
  @@map("transaction")
}

model biowaste_disposal {
  id            BigInt   @id @default(autoincrement()) @map("disposal_id")
  user_id       Int
  uid           String   @db.VarChar(36)
  kilogram      Decimal  @db.Decimal(10, 2)
  points_earned Int      @default(0)
  created_at    DateTime @default(now()) @db.DateTime(0)
  user          user     @relation(fields: [user_id], references: [id], onDelete: Cascade, map: "fk_biowaste_user")

  @@index([uid], map: "idx_biowaste_uid")
  @@index([user_id], map: "idx_biowaste_user_id")
  @@map("biowaste_disposal")
}

model checkpoint {
  id           Int      @id @default(autoincrement()) @map("checkpoint_id")
  user_id      Int      @unique(map: "user_id")
  uid          String   @db.VarChar(36)
  total_points Int      @default(0)
  last_updated DateTime @default(now()) @db.DateTime(0)
  user         user     @relation(fields: [user_id], references: [id], onDelete: Cascade, map: "fk_checkpoint_user")

  @@index([uid], map: "idx_checkpoint_uid")
  @@map("checkpoint")
}

model reward {
  id              Int      @id @default(autoincrement())
  name            String   @db.VarChar(100)
  points_required Int
  stock           Int      @default(0)
  available       Boolean  @default(true)
  thumbnail       String?  @db.VarChar(255)
  date_created    DateTime @default(now()) @db.DateTime(0)

  @@map("reward")
}
